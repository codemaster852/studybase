<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBase - The Ultimate AI Study Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --font-en: 'Inter', sans-serif;
            --font-ar: 'Cairo', sans-serif;
        }
        body {
            background-color: #0B0B0F;
            color: #E4E4E7;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        html[lang="en"] body { font-family: var(--font-en); }
        html[lang="ar"] body { font-family: var(--font-ar); }

        .sidebar {
            background-color: #101014;
            border-right: 1px solid #27272A;
        }
        html[dir="rtl"] .sidebar {
            border-right: none;
            border-left: 1px solid #27272A;
        }
        .main-content {
            background-color: #0B0B0F;
        }
        .feature-card, .main-title, .main-subtitle, .guest-btn-container {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.6s forwards;
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .modal {
            display: none; /* Hidden by default */
            background-color: rgba(11, 11, 15, 0.8);
            backdrop-filter: blur(5px);
        }
        .modal-content-area {
             background-color: #101014;
             border: 1px solid #27272A;
        }
        .btn-primary {
            background: linear-gradient(90deg, #4F46E5, #C13584);
            transition: transform 0.2s ease;
        }
        .btn-primary:hover {
            transform: scale(1.05);
        }
        .sidebar-heading {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #71717A;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .task-item {
            transition: opacity 0.3s ease;
        }
        .task-item.completed {
            opacity: 0.5;
        }
        .task-item.completed span {
            text-decoration: line-through;
        }
    </style>
</head>
<body class="flex h-screen">

    <!-- Sidebar -->
    <aside class="sidebar w-72 flex-shrink-0 p-6 hidden md:flex flex-col justify-between overflow-y-auto">
        <div>
            <h1 class="text-2xl font-bold text-white mb-8">StudyBase</h1>
            <nav class="flex flex-col">
                <h3 class="sidebar-heading" data-lang-key="sidebar_study_learning">Study & Learning</h3>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="summarize"><i class="fas fa-file-alt w-5 text-center"></i><span data-lang-key="feature_title_summarize">Text Summarizer</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="flashcards"><i class="fas fa-layer-group w-5 text-center"></i><span data-lang-key="feature_title_flashcards">Flashcard Generator</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="explain_concept"><i class="fas fa-brain w-5 text-center"></i><span data-lang-key="feature_title_explain_concept">Concept Explainer</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="quiz_generator"><i class="fas fa-question-circle w-5 text-center"></i><span data-lang-key="feature_title_quiz_generator">Quiz Generator</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="tutor"><i class="fas fa-user-graduate w-5 text-center"></i><span data-lang-key="feature_title_tutor">AI Tutor</span></a>
                
                <h3 class="sidebar-heading" data-lang-key="sidebar_time_management">Time Management</h3>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="pomodoro"><i class="fas fa-clock w-5 text-center"></i><span data-lang-key="feature_title_pomodoro">Pomodoro Timer</span></a>

                <h3 class="sidebar-heading" data-lang-key="sidebar_writing_research">Writing & Research</h3>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="essay_assistant"><i class="fas fa-pen-nib w-5 text-center"></i><span data-lang-key="feature_title_essay_assistant">Essay Assistant</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="paraphraser"><i class="fas fa-random w-5 text-center"></i><span data-lang-key="feature_title_paraphraser">Paraphrasing Tool</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="reference_generator"><i class="fas fa-book w-5 text-center"></i><span data-lang-key="feature_title_reference_generator">Reference Generator</span></a>

                <h3 class="sidebar-heading" data-lang-key="sidebar_course_help">Course Help</h3>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="math_solver"><i class="fas fa-calculator w-5 text-center"></i><span data-lang-key="feature_title_math_solver">Math Problem Solver</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="code_explainer"><i class="fas fa-code w-5 text-center"></i><span data-lang-key="feature_title_code_explainer">Code Explainer</span></a>
                
                <h3 class="sidebar-heading" data-lang-key="sidebar_career_prep">Career Prep</h3>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="resume_builder"><i class="fas fa-file-invoice w-5 text-center"></i><span data-lang-key="feature_title_resume_builder">AI Resume Builder</span></a>
                <a href="#" class="flex items-center space-x-3 text-zinc-400 hover:text-white py-2" data-feature="interview_prep"><i class="fas fa-comments w-5 text-center"></i><span data-lang-key="feature_title_interview_prep">Interview Practice</span></a>
            </nav>
        </div>
        <div>
            <button id="login-signup-btn" class="w-full text-left flex items-center space-x-3 text-zinc-400 hover:text-white">
                <i class="fas fa-user-circle w-5 text-center"></i>
                <span data-lang-key="login_signup">Login / Sign Up</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content flex-1 flex flex-col overflow-y-auto">
        <header class="p-6 flex justify-between items-center">
             <h1 class="text-2xl font-bold text-white md:hidden">StudyBase</h1>
             <button id="lang-switcher" class="px-4 py-2 text-sm font-semibold bg-zinc-800 rounded-md hover:bg-zinc-700">العربية</button>
             <button id="mobile-menu-button" class="md:hidden"><i class="fas fa-bars text-xl"></i></button>
        </header>

        <main class="flex-1 p-6 md:p-12">
            <div class="text-center">
                <h2 class="text-4xl md:text-6xl font-extrabold text-white leading-tight main-title" data-lang-key="main_title">
                    The Future of <br/> Learning is Here
                </h2>
                <p class="mt-6 text-lg text-zinc-400 max-w-2xl mx-auto main-subtitle" data-lang-key="main_subtitle" style="animation-delay: 0.1s;">
                    Leverage the power of AI for everything from summarizing articles and generating flashcards to acing your next interview.
                </p>
                <div class="mt-10 guest-btn-container" style="animation-delay: 0.2s;">
                    <button id="guest-btn" class="px-8 py-4 text-lg font-semibold rounded-lg text-white btn-primary" data-lang-key="explore_tools">
                        Explore The Tools
                    </button>
                </div>
            </div>

            <div id="features" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mt-20">
                <!-- Feature Cards -->
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="summarize" style="animation-delay: 0.3s;"><i class="fas fa-file-alt text-2xl text-blue-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_summarize">Text Summarizer</h4><p class="text-zinc-400" data-lang-key="feature_desc_summarize">Condense long articles into key points.</p></div>
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="quiz_generator" style="animation-delay: 0.4s;"><i class="fas fa-question-circle text-2xl text-green-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_quiz_generator">Quiz Generator</h4><p class="text-zinc-400" data-lang-key="feature_desc_quiz_generator">Create practice tests from any material.</p></div>
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="pomodoro" style="animation-delay: 0.5s;"><i class="fas fa-clock text-2xl text-orange-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_pomodoro">Pomodoro Timer</h4><p class="text-zinc-400" data-lang-key="feature_desc_pomodoro">Boost focus with timed study sessions.</p></div>
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="essay_assistant" style="animation-delay: 0.6s;"><i class="fas fa-pen-nib text-2xl text-yellow-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_essay_assistant">Essay Assistant</h4><p class="text-zinc-400" data-lang-key="feature_desc_essay_assistant">Get help with structure, thesis, and proofreading.</p></div>
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="code_explainer" style="animation-delay: 0.7s;"><i class="fas fa-code text-2xl text-indigo-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_code_explainer">Code Explainer</h4><p class="text-zinc-400" data-lang-key="feature_desc_code_explainer">Understand any code snippet, line by line.</p></div>
                <div class="feature-card p-6 rounded-xl cursor-pointer" data-feature="resume_builder" style="animation-delay: 0.8s;"><i class="fas fa-file-invoice text-2xl text-purple-400 mb-4"></i><h4 class="text-xl font-semibold mb-2 text-white" data-lang-key="feature_title_resume_builder">AI Resume Builder</h4><p class="text-zinc-400" data-lang-key="feature_desc_resume_builder">Craft the perfect resume for your dream job.</p></div>
            </div>
        </main>
    </div>

    <!-- Feature Modal -->
    <div id="feature-modal" class="modal fixed inset-0 flex items-center justify-center z-50 p-4">
        <div class="modal-content-area rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-zinc-700 flex justify-between items-center"><h3 id="modal-title" class="text-xl font-bold text-white" data-lang-key="modal_feature_title">Feature</h3><button id="modal-close-btn" class="text-zinc-500 hover:text-white text-2xl">&times;</button></div>
            <div id="modal-content" class="p-6 flex-1 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Auth Modal & Mobile Menu Modal -->
    <div id="auth-modal" class="modal fixed inset-0 flex items-center justify-center z-50 p-4"><div class="modal-content-area rounded-lg shadow-2xl w-full max-w-md text-center p-8"><h3 class="text-2xl font-bold text-white mb-4" data-lang-key="auth_modal_title">Create an Account to Save</h3><p class="text-zinc-400 mb-6" data-lang-key="auth_modal_desc">Sign up to save your history and unlock all features.</p><button class="w-full px-6 py-3 text-white font-semibold rounded-lg btn-primary" data-lang-key="auth_modal_signup">Sign Up Now</button><button id="auth-modal-close-btn" class="mt-4 text-zinc-500 hover:text-zinc-300" data-lang-key="auth_modal_later">Maybe Later</button></div></div>
    <div id="mobile-menu-modal" class="modal fixed inset-0 z-50"><div class="sidebar w-72 h-full p-6 flex flex-col justify-between"><div id="mobile-nav-content"></div><div><button id="mobile-login-signup-btn" class="w-full text-left flex items-center space-x-3 text-zinc-400 hover:text-white"><i class="fas fa-user-circle w-5 text-center"></i><span data-lang-key="login_signup">Login / Sign Up</span></button></div></div></div>
    <audio id="alarm-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

    <script>
        // --- LANGUAGE DATA STORE ---
        const langData = {
            en: {
                // Titles & Headings
                page_title: "StudyBase - The Ultimate AI Study Hub",
                main_title: "The Future of <br/> Learning is Here",
                sidebar_study_learning: "Study & Learning",
                sidebar_time_management: "Time Management",
                sidebar_writing_research: "Writing & Research",
                sidebar_course_help: "Course Help",
                sidebar_career_prep: "Career Prep",
                modal_feature_title: "Feature",
                auth_modal_title: "Create an Account to Save",

                // Subtitles & Descriptions
                main_subtitle: "Leverage the power of AI for everything from summarizing articles and generating flashcards to acing your next interview.",
                auth_modal_desc: "Sign up to save your history and unlock all features.",
                
                // Buttons & Links
                explore_tools: "Explore The Tools",
                login_signup: "Login / Sign Up",
                auth_modal_signup: "Sign Up Now",
                auth_modal_later: "Maybe Later",
                lang_switcher_en: "English",
                lang_switcher_ar: "العربية",

                // Feature Cards Descriptions
                feature_desc_summarize: "Condense long articles into key points.",
                feature_desc_quiz_generator: "Create practice tests from any material.",
                feature_desc_pomodoro: "Boost focus with timed study sessions.",
                feature_desc_essay_assistant: "Get help with structure, thesis, and proofreading.",
                feature_desc_code_explainer: "Understand any code snippet, line by line.",
                feature_desc_resume_builder: "Craft the perfect resume for your dream job.",
            },
            ar: {
                // Titles & Headings
                page_title: "StudyBase - مركز الدراسة الذكي",
                main_title: "مستقبل التعليم <br/> هنا",
                sidebar_study_learning: "دراسة وتعلم",
                sidebar_time_management: "إدارة الوقت",
                sidebar_writing_research: "كتابة وبحث",
                sidebar_course_help: "مساعدة في المواد",
                sidebar_career_prep: "تحضير للمهنة",
                modal_feature_title: "الميزة",
                auth_modal_title: "أنشئ حسابًا للحفظ",

                // Subtitles & Descriptions
                main_subtitle: "استفد من قوة الذكاء الاصطناعي في كل شيء، من تلخيص المقالات وإنشاء البطاقات التعليمية إلى التفوق في مقابلتك التالية.",
                auth_modal_desc: "سجل لحفظ سجلك وفتح جميع الميزات.",

                // Buttons & Links
                explore_tools: "استكشف الأدوات",
                login_signup: "تسجيل الدخول / اشتراك",
                auth_modal_signup: "اشترك الآن",
                auth_modal_later: "ربما لاحقًا",
                lang_switcher_en: "English",
                lang_switcher_ar: "العربية",

                // Feature Cards Descriptions
                feature_desc_summarize: "لخص المقالات الطويلة في نقاط رئيسية.",
                feature_desc_quiz_generator: "أنشئ اختبارات تدريبية من أي مادة.",
                feature_desc_pomodoro: "عزز تركيزك بجلسات دراسية محددة بوقت.",
                feature_desc_essay_assistant: "احصل على مساعدة في الهيكل، الأطروحة، والتدقيق.",
                feature_desc_math_solver: "حل مسائل الرياضيات المعقدة خطوة بخطوة.",
                feature_desc_code_explainer: "افهم أي مقطع برمجي، سطراً بسطر.",
                feature_desc_resume_builder: "اصنع السيرة الذاتية المثالية لوظيفة أحلامك.",
            }
        };

        const featuresData = {
            en: {
                summarize: { title: 'Text Summarizer', desc: 'Condense long articles, papers, or notes into key bullet points or a concise paragraph.', placeholder: 'Paste your text here...', button: 'Summarize Text' },
                flashcards: { title: 'Flashcard Generator', desc: 'Automatically create study cards from your notes. The AI will identify key terms and definitions.', placeholder: 'Paste your notes here...', button: 'Generate Flashcards' },
                explain_concept: { title: 'Concept Explainer', desc: 'Struggling with a difficult topic? Enter it below and get a simple, easy-to-understand explanation.', placeholder: 'e.g., Photosynthesis, General Relativity...', button: 'Explain Concept' },
                quiz_generator: { title: 'Quiz Generator', desc: 'Test your knowledge. Paste your study material and the AI will generate a multiple-choice quiz.', placeholder: 'Paste your study material here...', button: 'Generate Quiz' },
                tutor: { title: 'AI Tutor', desc: 'Your 24/7 homework helper. Ask any academic question and get a detailed answer.', placeholder: 'e.g., What were the main causes of the French Revolution?', button: 'Ask Question' },
                pomodoro: { title: 'Pomodoro Timer', desc: 'Boost your focus with the Pomodoro Technique. Set timers for work sessions and breaks.', work: 'Work', short_break: 'Short Break', long_break: 'Long Break', start: 'Start', pause: 'Pause', reset: 'Reset', tasks_title: 'Session Tasks', add_task_placeholder: 'Add a new task...' },
                essay_assistant: { title: 'Essay Assistant', desc: 'Beat writer\'s block. Provide a topic or a draft to get help with outlines, thesis statements, or counter-arguments.', placeholder: 'Enter your essay topic or paste your draft here...', button: 'Get Assistance' },
                paraphraser: { title: 'Paraphrasing Tool', desc: 'Reword sentences or paragraphs to avoid plagiarism and improve clarity. Paste your text below.', placeholder: 'Paste your text here...', button: 'Paraphrase' },
                reference_generator: { title: 'Reference Generator', desc: 'Generate citations instantly. Provide source information and specify the format.', placeholder: 'Source info: author, title, year, etc.', button: 'Generate Citation', style_placeholder: 'Citation Style (e.g., APA, MLA)' },
                math_solver: { title: 'Math Problem Solver', desc: 'Get step-by-step solutions to math problems, from algebra to calculus.', placeholder: 'e.g., Solve for x: 2x + 5 = 15', button: 'Solve Problem' },
                code_explainer: { title: 'Code Explainer', desc: 'Paste any code snippet to get a detailed, line-by-line explanation of how it works.', placeholder: 'Paste your code here...', button: 'Explain Code' },
                resume_builder: { title: 'AI Resume Builder', desc: 'Craft compelling, professional bullet points for your resume. Paste the job description and your experience.', placeholder: 'Paste job description and/or your experience notes...', button: 'Generate Bullet Points', job_placeholder: 'Target Job Title (e.g., Software Engineer)' },
                interview_prep: { title: 'Interview Practice', desc: 'Prepare for your next interview. Enter a job role, and the AI will generate common interview questions.', placeholder: 'Enter Job Role (e.g., Marketing Analyst)', button: 'Get Questions' },
            },
            ar: {
                summarize: { title: 'ملخص نصوص', desc: 'لخص المقالات الطويلة أو الأبحاث أو الملاحظات في نقاط رئيسية أو فقرة موجزة.', placeholder: 'الصق النص هنا...', button: 'لخص النص' },
                flashcards: { title: 'منشئ بطاقات تعليمية', desc: 'أنشئ بطاقات دراسية تلقائيًا من ملاحظاتك. سيتعرف الذكاء الاصطناعي على المصطلحات والتعريفات الرئيسية.', placeholder: 'الصق ملاحظاتك هنا...', button: 'أنشئ بطاقات' },
                explain_concept: { title: 'شرح المفاهيم', desc: 'هل تواجه صعوبة في موضوع ما؟ أدخله أدناه واحصل على شرح بسيط وسهل الفهم.', placeholder: 'مثال: التمثيل الضوئي، النسبية العامة...', button: 'اشرح المفهوم' },
                quiz_generator: { title: 'منشئ اختبارات', desc: 'اختبر معلوماتك. الصق مادة الدراسة الخاصة بك وسيقوم الذكاء الاصطناعي بإنشاء اختبار متعدد الخيارات.', placeholder: 'الصق مادة الدراسة هنا...', button: 'أنشئ اختبارًا' },
                tutor: { title: 'مدرس ذكاء اصطناعي', desc: 'مساعدك في الواجبات المنزلية على مدار الساعة. اطرح أي سؤال أكاديمي واحصل على إجابة مفصلة.', placeholder: 'مثال: ما هي الأسباب الرئيسية للثورة الفرنسية؟', button: 'اطرح سؤالاً' },
                pomodoro: { title: 'مؤقت بومودورو', desc: 'عزز تركيزك باستخدام تقنية بومودورو. اضبط مؤقتات لجلسات العمل والاستراحات.', work: 'عمل', short_break: 'استراحة قصيرة', long_break: 'استراحة طويلة', start: 'ابدأ', pause: 'إيقاف مؤقت', reset: 'إعادة ضبط', tasks_title: 'مهام الجلسة', add_task_placeholder: 'أضف مهمة جديدة...' },
                essay_assistant: { title: 'مساعد المقالات', desc: 'تغلب على حصار الكاتب. قدم موضوعًا أو مسودة للحصول على مساعدة في الخطوط العريضة والأطروحات والحجج المضادة.', placeholder: 'أدخل موضوع مقالتك أو الصق مسودتك هنا...', button: 'احصل على مساعدة' },
                paraphraser: { title: 'أداة إعادة الصياغة', desc: 'أعد صياغة الجمل أو الفقرات لتجنب الانتحال وتحسين الوضوح. الصق النص أدناه.', placeholder: 'الصق النص هنا...', button: 'أعد الصياغة' },
                reference_generator: { title: 'منشئ المراجع', desc: 'أنشئ الاستشهادات على الفور. قدم معلومات المصدر وحدد التنسيق.', placeholder: 'معلومات المصدر: المؤلف، العنوان، السنة، إلخ.', button: 'أنشئ مرجعًا', style_placeholder: 'نمط التوثيق (مثال: APA, MLA)' },
                math_solver: { title: 'حل مسائل الرياضيات', desc: 'احصل على حلول خطوة بخطوة لمسائل الرياضيات، من الجبر إلى التفاضل والتكامل.', placeholder: 'مثال: حل لـ س: 2س + 5 = 15', button: 'حل المسألة' },
                code_explainer: { title: 'شرح الأكواد', desc: 'الصق أي مقطع برمجي للحصول على شرح مفصل سطرًا بسطر لكيفية عمله.', placeholder: 'الصق الكود هنا...', button: 'اشرح الكود' },
                resume_builder: { title: 'باني السيرة الذاتية الذكي', desc: 'صياغة نقاط قوية واحترافية لسيرتك الذاتية. الصق وصف الوظيفة وخبرتك.', placeholder: 'الصق وصف الوظيفة و/أو ملاحظات خبرتك...', button: 'أنشئ نقاط السيرة الذاتية', job_placeholder: 'المسمى الوظيفي المستهدف (مثال: مهندس برمجيات)' },
                interview_prep: { title: 'التحضير للمقابلة', desc: 'استعد لمقابلتك التالية. أدخل دورًا وظيفيًا، وسيقوم الذكاء الاصطناعي بإنشاء أسئلة مقابلة شائعة.', placeholder: 'أدخل الدور الوظيفي (مثال: محلل تسويق)', button: 'احصل على أسئلة' },
            }
        };
        
        // --- SCRIPT START ---
        let currentLang = 'en';
        let isGuest = false;
        let currentUser = null;
        const supabaseUrl = 'https://djsuwmyvobfwxfghjuky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqc3V3bXl2b2Jmd3hmZ2hqdWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3ODExODQsImV4cCI6MjA2OTM1NzE4NH0.Zd5LyNb3UAL2_PwTb8o1BFhMB0UNuvp6TLkQb9ntMjA';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        const featureModal = document.getElementById('feature-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const closeModalBtn = document.getElementById('modal-close-btn');
        const authModal = document.getElementById('auth-modal');
        const closeAuthModalBtn = document.getElementById('auth-modal-close-btn');
        const mobileMenuModal = document.getElementById('mobile-menu-modal');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const guestBtn = document.getElementById('guest-btn');
        const allFeatureLinks = document.querySelectorAll('[data-feature]');
        const langSwitcher = document.getElementById('lang-switcher');
        const alarmSound = document.getElementById('alarm-sound');

        const openModal = (modalElement) => modalElement.style.display = 'flex';
        const closeModal = (modalElement) => modalElement.style.display = 'none';

        closeModalBtn.addEventListener('click', () => closeModal(featureModal));
        closeAuthModalBtn.addEventListener('click', () => closeModal(authModal));
        mobileMenuButton.addEventListener('click', () => openModal(mobileMenuModal));
        
        window.addEventListener('click', (event) => {
            if (event.target === featureModal) closeModal(featureModal);
            if (event.target === authModal) closeModal(authModal);
            if (event.target === mobileMenuModal) closeModal(mobileMenuModal);
        });

        function setLanguage(lang) {
            currentLang = lang;
            const data = langData[lang];
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.dataset.langKey;
                if (data[key]) {
                    el.innerHTML = data[key];
                }
            });

            document.querySelectorAll('.feature-card[data-feature]').forEach(card => {
                const featureKey = card.dataset.feature;
                const featureData = featuresData[lang][featureKey];
                if (featureData) {
                    card.querySelector('h4').textContent = featureData.title;
                    card.querySelector('p').textContent = featureData.desc;
                }
            });

             document.querySelectorAll('aside nav a[data-feature], #mobile-nav-content nav a[data-feature]').forEach(link => {
                const featureKey = link.dataset.feature;
                const featureData = featuresData[lang][featureKey];
                if (featureData) {
                    link.querySelector('span').textContent = featureData.title;
                }
            });
            
            langSwitcher.textContent = lang === 'en' ? data.lang_switcher_ar : data.lang_switcher_en;
            document.title = data.page_title;
        }

        langSwitcher.addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'ar' : 'en';
            setLanguage(newLang);
        });
        
        function setupMobileMenu() {
            const desktopSidebarContent = document.querySelector('aside .flex-col').innerHTML;
            const mobileNavContent = document.getElementById('mobile-nav-content');
            mobileNavContent.innerHTML = `<div class="flex justify-between items-center mb-8"><h1 class="text-2xl font-bold text-white">StudyBase</h1><button id="mobile-menu-close-btn"><i class="fas fa-times text-xl"></i></button></div>` + desktopSidebarContent;
            document.getElementById('mobile-menu-close-btn').addEventListener('click', () => closeModal(mobileMenuModal));
            
            mobileNavContent.querySelectorAll('[data-feature]').forEach(link => {
                 link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const featureKey = link.dataset.feature;
                    openFeatureModal(features[featureKey]);
                    closeModal(mobileMenuModal);
                });
            });
        }

        guestBtn.addEventListener('click', () => {
            isGuest = true;
            currentUser = null;
            openFeatureModal(features['summarize']);
        });

        document.getElementById('login-signup-btn').addEventListener('click', () => openModal(authModal));
        document.getElementById('mobile-login-signup-btn').addEventListener('click', () => {
            closeModal(mobileMenuModal);
            openModal(authModal);
        });

        allFeatureLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const featureKey = link.dataset.feature;
                openFeatureModal(features[featureKey]);
            });
        });

        function openFeatureModal(feature) {
            const featureContent = featuresData[currentLang][feature.key];
            modalTitle.textContent = featureContent.title;
            modalContent.innerHTML = feature.getContent(featureContent);
            openModal(featureModal);
            if (feature.init) {
                feature.init();
            }
        }

        async function callGemini(prompt, outputElement) {
            const loadingSpinner = `<div class="flex justify-center items-center p-8"><div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-400"></div></div>`;
            outputElement.innerHTML = loadingSpinner;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiKey = "AIzaSyAlJKRziOoxaPzxBQtZFmBhxjblOmfIXDU"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API Error Response:", errorText);
                    return currentLang === 'ar' ? `حدث خطأ: ${response.statusText} - ${errorText}` : `An error occurred: ${response.statusText} - ${errorText}`;
                }
                const responseText = await response.text();
                if (!responseText) {
                    console.error("API Error: Empty response from server.");
                    return currentLang === 'ar' ? "عذراً، خدمة الذكاء الاصطناعي أعادت استجابة فارغة. يرجى المحاولة مرة أخرى." : "Sorry, the AI service returned an empty response. Please try again.";
                }
                const result = JSON.parse(responseText);
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                }
                console.error("API Error: Unexpected response format", result);
                return currentLang === 'ar' ? "عذراً، لم أتمكن من معالجة الطلب. كانت الاستجابة من الذكاء الاصطناعي بتنسيق غير متوقع." : "Sorry, I couldn't process that. The response from the AI was in an unexpected format.";
            } catch (error) {
                console.error("Fetch/Parse Error:", error);
                return currentLang === 'ar' ? "حدث خطأ أثناء الاتصال بخدمة الذكاء الاصطناعي. يرجى التحقق من اتصالك والمحاولة مرة أخرى." : "An error occurred while contacting the AI service. Please check your connection and try again.";
            }
        }
        
        const commonTextArea = (id, placeholder, h='h-48') => `<textarea id="${id}" class="w-full ${h} p-3 bg-zinc-900 border border-zinc-700 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-zinc-300 resize-none" placeholder="${placeholder}"></textarea>`;
        const commonButton = (id, text) => `<button id="${id}" class="mt-4 px-6 py-2 text-white font-semibold rounded-lg btn-primary">${text}</button>`;
        const commonOutputDiv = `<div id="ai-output" class="mt-6 p-4 bg-zinc-900 border border-zinc-700 rounded-md min-h-[100px] whitespace-pre-wrap"></div>`;
        
        const features = {
            summarize: { key: 'summarize', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال نص لتلخيصه." : "Please enter text to summarize."; return; } const prompt = `Summarize the following text into key bullet points:\n\n${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            flashcards: { key: 'flashcards', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء تقديم مادة لإنشاء بطاقات منها." : "Please provide material to generate flashcards from."; return; } const prompt = `Generate flashcards from the following text. For each, provide a 'Term' and a 'Definition'. Format it clearly, like:\nTerm: [Term]\nDefinition: [Definition]\n---`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            explain_concept: { key: 'explain_concept', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="text-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md" placeholder="${d.placeholder}">${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال مفهوم لشرحه." : "Please enter a concept to explain."; return; } const prompt = `Explain the concept "${text}" in simple, clear terms, as if explaining to a high school student. Use analogies if helpful.`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            quiz_generator: { key: 'quiz_generator', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء تقديم مادة لإنشاء اختبار منها." : "Please provide material to generate a quiz from."; return; } const prompt = `Generate a 5-question multiple-choice quiz from the text below. For each question, provide 4 options (A, B, C, D) and indicate the correct answer.\n\n${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            tutor: { key: 'tutor', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="text-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md" placeholder="${d.placeholder}">${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء طرح سؤال." : "Please ask a question."; return; } const prompt = `Answer the following student question clearly and comprehensively: "${text}"`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            pomodoro: {
                key: 'pomodoro',
                getContent: (d) => `
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="flex-1 text-center">
                            <div class="w-64 h-64 mx-auto bg-zinc-900 rounded-full flex flex-col items-center justify-center border-4 border-zinc-700">
                                <div id="pomodoro-mode" class="text-xl font-semibold text-zinc-400">${d.work}</div>
                                <div id="pomodoro-time" class="text-6xl font-bold">25:00</div>
                            </div>
                            <div class="flex justify-center gap-4 mt-6">
                                <button id="pomodoro-start" class="px-6 py-2 bg-green-600 rounded-md hover:bg-green-700">${d.start}</button>
                                <button id="pomodoro-pause" class="px-6 py-2 bg-yellow-600 rounded-md hover:bg-yellow-700">${d.pause}</button>
                                <button id="pomodoro-reset" class="px-6 py-2 bg-red-600 rounded-md hover:bg-red-700">${d.reset}</button>
                            </div>
                            <div id="pomodoro-sessions" class="mt-4 text-zinc-400">Sessions: 0</div>
                        </div>
                        <div class="md:w-1/3">
                            <h4 class="font-semibold text-lg mb-4">${d.tasks_title}</h4>
                            <div id="pomodoro-tasks" class="space-y-2 max-h-60 overflow-y-auto"></div>
                            <div class="mt-4 flex gap-2">
                                <input type="text" id="pomodoro-new-task" class="flex-1 p-2 bg-zinc-900 border border-zinc-700 rounded-md" placeholder="${d.add_task_placeholder}">
                                <button id="pomodoro-add-task" class="px-4 bg-indigo-600 rounded-md hover:bg-indigo-700">+</button>
                            </div>
                        </div>
                    </div>
                `,
                init: () => {
                    let timer;
                    let time = 25 * 60;
                    let mode = 'work'; // work, short_break, long_break
                    let sessions = 0;
                    let isPaused = true;

                    const timeDisplay = document.getElementById('pomodoro-time');
                    const modeDisplay = document.getElementById('pomodoro-mode');
                    const sessionsDisplay = document.getElementById('pomodoro-sessions');
                    const startBtn = document.getElementById('pomodoro-start');
                    const pauseBtn = document.getElementById('pomodoro-pause');
                    const resetBtn = document.getElementById('pomodoro-reset');
                    const taskInput = document.getElementById('pomodoro-new-task');
                    const addTaskBtn = document.getElementById('pomodoro-add-task');
                    const taskList = document.getElementById('pomodoro-tasks');

                    const updateDisplay = () => {
                        const minutes = Math.floor(time / 60);
                        const seconds = time % 60;
                        timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        const d = featuresData[currentLang].pomodoro;
                        modeDisplay.textContent = d[mode.replace('_', '')];
                        sessionsDisplay.textContent = `${currentLang === 'ar' ? 'الجلسات' : 'Sessions'}: ${sessions}`;
                    };

                    const switchMode = () => {
                        alarmSound.play();
                        if (mode === 'work') {
                            sessions++;
                            mode = (sessions % 4 === 0) ? 'long_break' : 'short_break';
                            time = (mode === 'long_break' ? 15 : 5) * 60;
                        } else {
                            mode = 'work';
                            time = 25 * 60;
                        }
                        isPaused = true;
                        clearInterval(timer);
                        updateDisplay();
                    };

                    const tick = () => {
                        if (time > 0) {
                            time--;
                            updateDisplay();
                        } else {
                            switchMode();
                        }
                    };

                    startBtn.addEventListener('click', () => {
                        if (isPaused) {
                            isPaused = false;
                            timer = setInterval(tick, 1000);
                        }
                    });

                    pauseBtn.addEventListener('click', () => {
                        isPaused = true;
                        clearInterval(timer);
                    });

                    resetBtn.addEventListener('click', () => {
                        isPaused = true;
                        clearInterval(timer);
                        time = (mode === 'work' ? 25 : (mode === 'short_break' ? 5 : 15)) * 60;
                        updateDisplay();
                    });

                    const renderTasks = () => {
                        taskList.innerHTML = '';
                        const tasks = JSON.parse(localStorage.getItem('pomodoroTasks') || '[]');
                        tasks.forEach((task, index) => {
                            const taskEl = document.createElement('div');
                            taskEl.className = `task-item flex items-center justify-between bg-zinc-800 p-2 rounded-md ${task.completed ? 'completed' : ''}`;
                            taskEl.innerHTML = `
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" data-index="${index}" ${task.completed ? 'checked' : ''} class="form-checkbox h-5 w-5 bg-zinc-900 border-zinc-700 rounded text-indigo-600">
                                    <span>${task.text}</span>
                                </div>
                                <button data-index="${index}" class="text-red-500 hover:text-red-400">&times;</button>
                            `;
                            taskList.appendChild(taskEl);
                        });
                    };

                    addTaskBtn.addEventListener('click', () => {
                        if (taskInput.value.trim()) {
                            const tasks = JSON.parse(localStorage.getItem('pomodoroTasks') || '[]');
                            tasks.push({ text: taskInput.value.trim(), completed: false });
                            localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
                            taskInput.value = '';
                            renderTasks();
                        }
                    });

                    taskList.addEventListener('click', (e) => {
                        const tasks = JSON.parse(localStorage.getItem('pomodoroTasks') || '[]');
                        const index = e.target.dataset.index;
                        if (e.target.type === 'checkbox') {
                            tasks[index].completed = e.target.checked;
                        } else if (e.target.tagName === 'BUTTON') {
                            tasks.splice(index, 1);
                        }
                        localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
                        renderTasks();
                    });

                    updateDisplay();
                    renderTasks();
                }
            },
            essay_assistant: { key: 'essay_assistant', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء تقديم موضوع أو مسودة." : "Please provide a topic or draft."; return; } const prompt = `Act as a writing tutor. Analyze the following essay topic/draft. Provide a potential thesis statement, a 3-point outline, and suggest one potential counter-argument to consider.\n\nTopic/Draft: ${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            paraphraser: { key: 'paraphraser', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال نص لإعادة صياغته." : "Please enter text to paraphrase."; return; } const prompt = `Paraphrase the following text, maintaining the original meaning but using different vocabulary and sentence structure:\n\n${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            reference_generator: { key: 'reference_generator', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="style-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md mb-2" placeholder="${d.style_placeholder}">${commonTextArea('text-input', d.placeholder, 'h-32')}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const style = document.getElementById('style-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim() || !style.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء تقديم معلومات المصدر ونمط التوثيق." : "Please provide source info and a citation style."; return; } const prompt = `Generate a citation in ${style} format based on the following information:\n\n${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            math_solver: { key: 'math_solver', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="text-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md" placeholder="${d.placeholder}">${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال مسألة رياضية." : "Please enter a math problem."; return; } const prompt = `Solve the following math problem. Provide a clear, step-by-step explanation of the solution process, followed by the final answer.\n\nProblem: ${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            code_explainer: { key: 'code_explainer', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p>${commonTextArea('code-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const code = document.getElementById('code-input').value; const outputDiv = document.getElementById('ai-output'); if (!code.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال كود." : "Please enter some code."; return; } const prompt = `Explain the following code snippet line by line. Use a friendly and clear tone, suitable for a beginner:\n\n\`\`\`\n${code}\n\`\`\``; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            resume_builder: { key: 'resume_builder', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="job-title-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md mb-2" placeholder="${d.job_placeholder}">${commonTextArea('text-input', d.placeholder)}${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const job = document.getElementById('job-title-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim() || !job.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء تقديم المسمى الوظيفي وبعض السياق." : "Please provide a job title and some context."; return; } const prompt = `Act as a professional resume writer. Based on the target job title "${job}" and the following information, generate 3-5 strong, action-oriented resume bullet points using the STAR (Situation, Task, Action, Result) method where possible:\n\n${text}`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
            interview_prep: { key: 'interview_prep', getContent: (d) => `<p class="text-zinc-400 mb-4">${d.desc}</p><input type="text" id="text-input" class="w-full p-3 bg-zinc-900 border border-zinc-700 rounded-md" placeholder="${d.placeholder}">${commonButton('run-btn', d.button)}${commonOutputDiv}`, init: () => document.getElementById('run-btn').addEventListener('click', async () => { const text = document.getElementById('text-input').value; const outputDiv = document.getElementById('ai-output'); if (!text.trim()) { outputDiv.textContent = currentLang === 'ar' ? "الرجاء إدخال دور وظيفي." : "Please enter a job role."; return; } const prompt = `Generate a list of 5 common behavioral and 3 technical/situational interview questions for a "${text}" position. For each behavioral question, briefly mention what the interviewer is trying to assess.`; outputDiv.textContent = await callGemini(prompt, outputDiv); }) },
        };
        
        // Initial Load
        window.onload = () => {
            document.body.style.opacity = 1;
            setupMobileMenu();
            setLanguage('en');
        };
    </script>
</body>
</html>
